Our infrastructure consists of a powerful Ubuntu workstation running at LAN IP 192.168.0.112 that hosts a full Kubernetes cluster via Minikube using the none driver, which means Kubernetes runs directly on the host without Docker isolation. The Ubuntu machine uses containerd as the container runtime instead of Docker, allowing for proper host-level networking and NodePort access. This setup was chosen specifically to enable MinIO and Argo Workflows to communicate seamlessly with external clients while allowing pods within the cluster to access services using both internal cluster DNS names and external IPs. The Mac laptop in this architecture acts purely as a remote kubectl client, connecting to the Ubuntu-hosted Minikube cluster over the LAN for cluster management and workflow submission without running any workloads locally.

Argo Workflows version 3.7.3 is installed in the argo namespace on the Kubernetes cluster and serves as the workflow orchestration engine for Metaflow pipelines. The Argo Server UI is exposed via NodePort 32045 and is accessible at https://192.168.0.112:32045 from the Mac client. MinIO, which provides S3-compatible object storage for Metaflow artifacts, runs as a pod in the argo namespace and has been upgraded to the latest MinIO image to ensure compatibility with modern S3 clients. The MinIO API is exposed on NodePort 32046 at http://192.168.0.112:32046, while the MinIO web dashboard is accessible on NodePort 32047 at http://192.168.0.112:32047. The default credentials for MinIO are admin/password, and a bucket named metaflow has been created to store all workflow artifacts and data.

A local HTTPS container registry runs on the Ubuntu machine at 192.168.0.112:5000, secured with mkcert-generated TLS certificates to avoid insecure registry warnings. Both the Ubuntu containerd daemon and the Mac Docker client have been configured to trust this self-signed certificate authority, enabling secure image push and pull operations. Images are built on the Mac (with --platform linux/amd64 specified for compatibility) and pushed to this registry, then pulled by Kubernetes pods running on Ubuntu when workflows are executed. The containerd configuration on Ubuntu includes a hosts.toml file under /etc/containerd/certs.d/192.168.0.112:5000/ that explicitly trusts the registry, and the Mac has the registry's root CA certificate installed in its system keychain.

Metaflow is configured to use this infrastructure through profile-based configuration files stored in .metaflowconfig directories within each demo folder. The configuration specifies S3 as the datastore with two endpoint URLs: one for local Mac execution pointing to the external IP (http://192.168.0.112:32046) and another for Kubernetes pods using the internal cluster DNS name (http://minio.argo.svc.cluster.local:9000). Workflows execute in the argo namespace using the argo service account, which has been granted cluster-admin permissions to create and manage WorkflowTaskResults and other Argo CRDs. When running workflows, AWS credentials are passed as environment variables (AWS_ACCESS_KEY_ID=admin and AWS_SECRET_ACCESS_KEY=password) to both local Python processes and containerized Kubernetes steps, allowing seamless artifact storage and retrieval from MinIO regardless of where the code executes.



